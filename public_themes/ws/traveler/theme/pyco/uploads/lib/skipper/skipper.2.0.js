(function(){var e,t,n,r,o,i,s,a,u,f,c=[].indexOf;u=window;a={name:"Skipper",version:"2.0.0",creator:["Redyyu"]};i="skipper_member_auth";r="skipper_member_open_id";o="skipper_member_profile";n=["appointee","contact","date","location"];e="https://api.soopro.io/crm/external";u.Skipper=function(a){var u,p,l,d,y,h,m,v,g,T,w;y={api_host:e,contentType:"application/json",responseType:"json",withCredentials:false,expires_in:3600*24*30};d=y;for(h in a){w=a[h];d[h]=w}if(!d.app_id){throw"app id is required!";return}p=d.api_host+"/"+d.app_id;u=new t;g=function(e,t,n){var r;if(!f.isDict(e.headers)){e.headers={}}if(e.token){e.headers["Authorization"]="Bearer "+e.token}if(!e.url){e.url=p+e.path}r=u.send({type:e.type,url:e.url,params:e.params,data:e.data,contentType:e.contentType||d.contentType,responseType:e.responseType||d.responseType,withCredentials:e.withCredentials||d.withCredentials,headers:e.headers});if(typeof t==="function"){r.then(function(e){var n;try{t(e)}catch(e){n=e;console.error(n)}return e})}if(typeof n==="function"){r.catch(function(e){var t;try{n(e)}catch(e){t=e;console.error(t)}return e})}return r};l=function(){var e;try{s.remove(o);s.remove(i);return s.remove(r)}catch(t){e=t;return console.error(e)}};v=function(e){var t,n,r,o,i,s,a;t={};if(f.isDict(e.fields)){s=e.fields;for(h in s){w=s[h];t[h]=w}}else if(f.isArray(e.fields)){a=e.fields;for(r=0,i=a.length;r<i;r++){n=a[r];o=n.name;if(t[o]){if(f.isArray(t[o])){t[o].push(n.value)}else{t[o]=[t[o],n.value]}}else{t[o]=n.value}}}return t};m=function(e){var t,r,o,i,s,a,u,p;r={event_slug:e.action,meta:{}};if(f.isDict(e.fields)){u=e.fields;for(h in u){w=u[h];if(c.call(n,h)>=0){r[h]=w}else{r.meta[h]=w}}}else if(f.isArray(e.fields)){p=e.fields;for(i=0,a=p.length;i<a;i++){o=p[i];s=o.name;if(c.call(n,s)>=0){r[s]=o.value}else{if(r.meta[s]){if(f.isArray(r.meta[s])){r.meta[s].push(o.value)}else{t=r.meta[s];r.meta[s]=[t,o.value]}}else{r.meta[s]=o.value}}}}return r};T={token:function(e){var t;if(e===null||e===false){try{s.remove(i)}catch(e){t=e;console.error(t);return false}}else if(e){try{s.set(i,e,d.expires_in)}catch(e){t=e;console.error(t);return false}}return s.get(i)},open_id:function(e){var t;if(e===null||e===false){try{s.remove(r)}catch(e){t=e;console.error(t);return false}}else if(e){try{s.set(r,e,d.expires_in)}catch(e){t=e;console.error(t);return false}}return s.get(r)},login:function(e,t,n){return g({path:"/login",type:"POST",data:e},function(e){var n;try{s.set(i,e.token,d.expires_in);s.set(r,e.open_id,d.expires_in)}catch(e){n=e;console.error(n)}if(f.isFunction(t)){return t(e)}},n)},logout:function(e,t){return g({path:"/logout",type:"GET",token:s.get(i)},function(t){l();if(f.isFunction(e)){return e(t)}},function(e){l();if(f.isFunction(t)){return t(data)}})},register:function(e,t,n){return g({path:"/register",type:"POST",data:e},t,n)},security:{pwd:function(e,t,n){return g({path:"/security/pwd",type:"PUT",data:e,token:s.get(i)},function(e){var n;try{s.set(i,e.token,d.expires_in);s.set(r,e.open_id,d.expires_in)}catch(e){n=e;console.error(n)}if(f.isFunction(t)){return t(e)}},n)}},profile:{get:function(e,t){var n,r;n=s.get(o);if(n){r=Promise.resolve(n);if(f.isFunction(e)){r.then(function(t){e(t);return t})}return r}else{return g({path:"/profile",type:"GET",token:s.get(i)},function(t){var n;try{s.set(o,t,d.expires_in)}catch(e){n=e;console.error(n)}if(f.isFunction(e)){return e(t)}},t)}},update:function(e,t,n){return g({path:"/profile",type:"PUT",data:e,token:s.get(i)},function(e){var n;try{s.set(o,e,d.expires_in)}catch(e){n=e;console.error(n)}if(f.isFunction(t)){return t(e)}},n)},clear:function(){var e;try{s.remove(o);return true}catch(t){e=t;console.error(e);return false}}},mailto:function(e){var t,n;t=function(){var t,n,r,o,i;n=e.action.split("?")[0].split("#")[0];if(n.toLowerCase().indexOf("mailto:")!==0){n="mailto:"+n}i=e.title||"";r="";o=v(e);for(h in o){w=o[h];t=f.isArray(w)?w.join(", "):w;r=r+h+": "+t+"\n"}r=encodeURIComponent(r);return n+"?subject="+i+"&body="+r};n=new Promise(function(e,n){var r;try{return e(t())}catch(e){r=e;return n(r)}});return n},appointment:{query:function(e,t){return g({path:"/appointment",type:"GET",token:s.get(i)},e,t)},create:function(e,t,n){return g({path:"/appointment",type:"POST",data:m(e),token:s.get(i)},t,n)},remove:function(e,t,n){return g({path:"/appointment/"+e,type:"DELETE",token:s.get(i)},t,n)}}};return T};if(!Promise.prototype["finally"]){Promise.prototype["finally"]=function(e){var t;t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})}}f={setParam:function(e,t){var n,r,o;e=encodeURIComponent(e);t=encodeURIComponent(t);o=document.location.search;n=e+"="+t;r=new RegExp("(&|\\?)"+e+"=[^&]*");o=o.replace(r,"$1"+n);if(!RegExp.$1){o+=(o.length>0?"&":"?")+n}document.location.search=o;return{key:t}},addParam:function(e,t){var n,r,o,i,s,a;if(typeof t!=="object"){return e}n=function(e,t,n){var r;r=e.indexOf("?")>-1?"&":"?";t=encodeURIComponent(t);n=encodeURIComponent(n);e=e+r+t+"="+n;return e};for(i in t){a=t[i];if(a!==null&&typeof a==="object"&&typeof a.length==="number"){for(o=0,s=a.length;o<s;o++){r=a[o];e=n(e,i,r)}}else{e=n(e,i,a)}}return e},getParam:function(e){var t,n,r,o,i,s;i={};o=window.location.search.substring(1);s=o.split("&");n=0;while(n<s.length){r=s[n].split("=");if(typeof i[r[0]]==="undefined"){i[r[0]]=decodeURIComponent(r[1])}else if(typeof i[r[0]]==="string"){t=[i[r[0]],decodeURIComponent(r[1])];i[r[0]]=t}else{i[r[0]].push(decodeURIComponent(r[1]))}n++}if(e){return i[e]}else{return i}},startswith:function(e,t){if(typeof e!=="string"||typeof t!=="string"){return null}return e.indexOf(t)===0},endswith:function(e,t){if(typeof e!=="string"||typeof t!=="string"){return null}return e.substr(e.length-t.length)===t},in_wechat:function(){var e;try{e=u.navigator.userAgent||""}catch(t){e=""}return e.indexOf("MicroMessenger")>=0},isNode:function(e){if(typeof Node==="object"){return e instanceof Node}else if(e&&typeof e==="object"){return typeof e.nodeType==="number"&&typeof e.nodeName==="string"}else{return false}},isElement:function(e){if(typeof HTMLElement==="object"){return e instanceof HTMLElement}else if(e&&typeof e==="object"&&e!==null){return e.nodeType===1&&typeof e.nodeName==="string"}else{return false}},isUrl:function(e){var t;if(typeof url!=="string"){return false}t=/^([\w]+:)?\/\/[a-zA-Z0-9]/i;return url.match(t)},isArray:function(e){return Array.isArray(e)},isDict:function(e){return typeof e==="object"&&!Array.isArray(e)},isFunction:function(e){return typeof e==="function"}};s={set:function(e,t,n,r,o){var i,s;n=n*1e3;t=JSON.stringify({value:t});i=new Date;i.setTime(i.getTime()+n);s=s?"expires="+i.toUTCString()+"; ":"";r=r?"path="+r+"; ":"path=/; ";o=o?"domain="+o+"; ":"";return document.cookie=e+"="+t+"; "+s+o+r},get:function(e){var t,n,r,o,i,s;o=e+"=";n=document.cookie.split(";");r=0;while(r<n.length){t=n[r];while(t.charAt(0)===" "){t=t.substring(1)}if(t.indexOf(o)===0){s=t.substring(o.length,t.length);try{i=JSON.parse(s);return i.value}catch(e){return s}}r++}return null},remove:function(e){var t,n,r;n="expires=Thu, 01 Jan 1970 00:00:00 UTC; ";r=r?"path="+r+"; ":"path=/; ";t=t?"domain="+t+"; ":"";return document.cookie=e+"=; "+n+t+r}};t=function(){var e,t,n;t={get:function(t){return e("GET",t)},post:function(t){return e("POST",t)},update:function(t){return e("PUT",t)},remove:function(t){return e("DELETE",t)},send:function(t){return e(t.type,t)}};e=function(e,t){var r,o,i,s,a,u,c;c=new XMLHttpRequest;a=f.addParam(t.url,t.params);c.open(e,a||"",true);c.responseType=t.responseType;c.withCredentials=Boolean(t.withCredentials);c.setRequestHeader("Content-Type",t.contentType);c.setRequestHeader("X-Requested-With","XMLHttpRequest");if(typeof t.headers==="object"){i=t.headers;for(r in i){u=i[r];c.setRequestHeader(r,u)}}o=new Promise(function(e,t){var r;r=function(o){var i;c=this;if(c.readyState===c.DONE){c.removeEventListener("readystatechange",r);i=n(c);if(c.status>=200&&c.status<399){return e(i.data)}else{return t(i)}}};return c.addEventListener("readystatechange",r)});if(e==="GET"||e==="DELETE"){c.send()}else{s=JSON.stringify(t.data||{});c.send(s)}return o};n=function(e,t){var n,r,o,i;if(e.responseType==="json"){n=e.response}else if((r=e.responseType)==="blob"||r==="arraybuffer"){n=e.response}else if(e.responseType==="document"){n=e.responseXML}else if((o=e.responseType)===""||o==="text"){n=e.responseText}i={data:n,headers:e.getAllResponseHeaders(),status:e.status,statusText:e.statusText,responseType:e.responseType,responseURL:e.responseURL};return i};return t};Skipper.utils=f;Skipper.version=a.version}).call(this);
