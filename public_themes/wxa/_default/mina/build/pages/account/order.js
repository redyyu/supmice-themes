// Generated by CoffeeScript 2.0.2
(function() {
  var app, core, deco, restCustomer, restStore, utils;

  core = require('../../core.js');

  deco = require('../../decorators.js');

  utils = require('../../utils.js');

  restStore = require('../../restapi/store.js');

  restCustomer = require('../../restapi/customer.js');

  app = getApp();

  core.Page({
    data: {
      image: core.image,
      profile: null,
      orders: [],
      total_count: null,
      has_more: false,
      logged: null
    },
    submitted: false,
    // lifecycle
    onLoad: deco.login_required(function(opts) {
      var self;
      self = this;
      self.id = opts.id;
      app.set_navbar(core.static_title.order);
      return restCustomer.order.get(opts.id).then(function(order) {
        return self.setData({
          order: order,
          logged: true
        });
      });
    }),
    // hanlders
    copy_delivery: function(e) {
      var delivery;
      delivery = e.currentTarget.dataset.delivery;
      if (!delivery) {
        return;
      }
      wx.setClipboardData({
        data: delivery
      });
      return wx.showToast({
        icon: 'none',
        title: delivery
      });
    },
    complete_order: function(e) {
      var content, self, title;
      self = this;
      title = e.currentTarget.dataset.title;
      content = e.currentTarget.dataset.content;
      if (self.submitted) {
        return;
      }
      return core.dialog.confirm({
        title: title,
        content: content,
        confirm: function() {
          self.submitted = true;
          return restCustomer.order.done(self.id).then(function(order) {
            return self.setData({
              order: order
            });
          }).finally(function() {
            return self.submitted = false;
          });
        }
      });
    }
  });

}).call(this);
