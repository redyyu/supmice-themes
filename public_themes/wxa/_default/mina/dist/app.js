var core,restStore,utils;core=require("core.js");utils=require("utils.js");restStore=require("restapi/store.js");App({project:{name:"Julolo Mini",version:"1.5.5",creator:["Redyyu"]},onLaunch:function(e){var r;r=this;console.info("Julolo Launched...");console.info("-------------------");console.info(r.project.name);console.info(r.project.version);console.info(r.project.creator.join(", "));if(e.query.api){core.config.baseURL.api=e.query.api}return restStore.store.get().then(function(e){return r.store=e})},g:{},store:{},cart:new core.Cart,enter_item:function(e){var r;if(!e){return}r=this;r.g.current_item=e;return r.goto({route:core.config.paths.item,query:{id:e.id}})},goto:function(e,r){var t,o,n,i,u,c,a,s;u=this;if(wx.getStorageSync("auth")||!r){c=e.route;t="?";i=e.query;for(o in i){a=i[o];if(o&&a){c=c+t+o+"="+a;t="&"}}n=e.method||wx.navigateTo;return n({url:c})}else{s={route:e.route||"",query:e.query||{}};wx.setStorageSync("warp_point",s);return wx.redirectTo({url:core.config.paths.login})}},back:function(e){return wx.navigateBack({delta:e||1})},chown:function(e){var r;r=wx.getStorageSync("auth")||{};return r.id===e&&e},get_profile:function(e){var r;r=this;if(!utils.isFunction(e)){e=function(){}}if(!r.g.profile){r.g.profile=wx.getStorageSync("profile")||{}}return e(r.g.profile)},sync_profile:function(e){var r;r=this;if(!utils.isFunction(e)){e=function(){}}return core.authorize_run({scope:"scope.userInfo",required:true},function(t){return wx.getUserInfo({success:function(t){var o;o=core.make_profile(t.userInfo);r.g.profile=o;wx.setStorageSync("profile",o);return e(r.g.profile)}})})},share:function(e){var r,t,o,n;t=this;if(!e){e=t.store}r=e.splash||e.src;n=e.title;o={title:n,imageUrl:r};if(e.is_extra){o.path=core.config.paths.index}else if(e.share_path){o.path=e.share_path||null}return o},parse_coupon:function(e){var r,t,o;t=/减(\d+)元?/gi;o=/(\d+)元无条件/gi;try{r=t.exec(e)||o.exec(e)}catch(e){r=null}if(r&&utils.isString(r[1])){return r[1]+"元券"}else{return""}},show_coupon:function(e){wx.setClipboardData({data:e.code||"..."});return core.dialog.alert({title:e.code,content:e.msg})},go_cart:function(){return wx.switchTab({url:core.config.paths.user})},go_error:function(){return wx.redirectTo({url:core.config.paths.error})},re_launch:function(e){var r;r=this;return wx.reLaunch({url:core.config.paths.index})},debug:function(){var e,r;r=wx.getStorageSync("auth");if(!r.supervisor){return}e=!Boolean(wx.getStorageSync("debug"));return wx.setEnableDebug({enableDebug:e,success:function(){return wx.setStorageSync("debug",e)}})}});
