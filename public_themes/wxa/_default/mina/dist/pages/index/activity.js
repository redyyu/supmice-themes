(function(){var t,e,a,i;e=require("../../core.js");i=require("../../utils.js");a=require("../../restapi/store.js");t=getApp();Page({data:{image:e.image,is_loading:null,has_more:null,commodities:[],activity:null},paged:1,perpage:12,timestamp:i.now(),onShareAppMessage:function(){var e;e=this;return t.share(e.data.activity)},onLoad:function(t){var e;e=this;return a.activity.get(t.slug).then(function(t){return e.setData({activity:t})}).then(function(){return e.list_items()})},onPullDownRefresh:function(){var t;t=this;t.paged=1;t.timestamp=i.now();t.setData({commodities:[],has_more:null});return t.list_cat().finally(function(){return wx.stopPullDownRefresh()})},onReachBottom:function(){var t;t=this;if(t.data.has_more===true){t.paged+=1;return t.list_items()}},list_items:function(){var e,i;i=this;i.setData({is_loading:true});e=i.data.activity.slug;return a.activity.items(e,{data:{paged:i.paged,perpage:i.perpage}}).then(function(e){var a,n,r;for(a=0,r=e.length;a<r;a++){n=e[a];n.coupon=t.parse_coupon(n.coupon_info)}return i.setData({commodities:i.data.commodities.concat(e),has_more:e[0]&&e[0]._more})}).finally(function(){return i.setData({is_loading:false})})},enter:function(e){return t.enter_item(e.currentTarget.dataset.item)}})}).call(this);
